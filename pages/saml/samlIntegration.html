

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Build your service &mdash; GOV.UK Verify Technical Guide  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="GOV.UK Verify Technical Guide  documentation" href="../../index.html"/>
        <link rel="up" title="SAML" href="saml.html"/>
        <link rel="next" title="Run SAML compliance tests" href="samlComplianceTool.html"/>
        <link rel="prev" title="How SAML works with GOV.UK Verify" href="samlWorks.html"/>
  <link href="../../_static/style.css" rel="stylesheet" type="text/css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.2/moment.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.0.4/js.cookie.js"></script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-54060634-2', 'auto');
    ga('send', 'pageview');

  </script>
  <script type="text/javascript" src="../../_static/CookieBanner.js"></script>
  <script>
    $(function() {new CookieBanner("seen_cookie_message", 28, "ida-cookie-message").launch();});
  </script>


  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> GOV.UK Verify Technical Guide
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">GOV.UK Verify technical documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arch/arch.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../steps/steps.html">Steps to integrate GOV.UK Verify into your service</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="saml.html">SAML</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="samlWorks.html">How SAML works with GOV.UK Verify</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Build your service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#use-extended-validation-certificates">Use extended validation certificates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#choose-a-product-and-framework">Choose a product and framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connect-your-service-to-the-matching-service-adapter-metadata">Connect your service to the Matching Service Adapter metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#send-a-saml-authentication-request-to-the-gov-uk-verify-hub">Send a SAML authentication request to the GOV.UK Verify hub</a></li>
<li class="toctree-l3"><a class="reference internal" href="#handle-saml-responses-using-saml-metadata">Handle SAML responses using SAML metadata</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="samlComplianceTool.html">Run SAML compliance tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="generateSelfSignedCertificates.html">Generate self-signed certificates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ms/ms.html">Local Matching Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../msa/msa.html">Matching Service Adapter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pki/pki.html">Public Key Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../env/env.html">GOV.UK Verify environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../open/opencomponents.html">Open components and contribution</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">GOV.UK Verify Technical Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="saml.html">SAML</a> &raquo;</li>
      
    <li>Build your service</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="build-your-service">
<span id="samlintegration"></span><h1>Build your service<a class="headerlink" href="#build-your-service" title="Permalink to this headline">¶</a></h1>
<div class="section" id="use-extended-validation-certificates">
<span id="samlintegrationtool"></span><h2>Use extended validation certificates<a class="headerlink" href="#use-extended-validation-certificates" title="Permalink to this headline">¶</a></h2>
<p>You must use extended validation (EV) certificates for all public interactions with your service. When you use EV certificates, the user&#8217;s web browser clearly indicates the name of the organisation they are interacting with.</p>
<p>Using EV certificates is one of a range of measures to protect your users from sites pretending to be you. See best practices for <a class="reference external" href="https://www.ncsc.gov.uk/guidance/tls-external-facing-services">using TLS to protect data</a> from the National Cyber Security Centre (NCSC).</p>
</div>
<div class="section" id="choose-a-product-and-framework">
<span id="chooseproductframework"></span><h2>Choose a product and framework<a class="headerlink" href="#choose-a-product-and-framework" title="Permalink to this headline">¶</a></h2>
<p>Your government service must be able to send SAML authentication requests to, and receive SAML responses from, the GOV.UK Verify hub.</p>
<p>You can choose from a wide range of off-the-shelf products and frameworks to integrate your service with GOV.UK Verify.</p>
<p>GOV.UK Verify has experience integrating and supporting services using Shibboleth-SP (Service Provider) and OpenSAML libraries. This has worked well for teams using Java. However, please use the most appropriate products and frameworks for your team.  See <a class="reference external" href="https://www.gov.uk/service-manual/making-software/choosing-technology.html">Choosing technology</a> in the Government Service Design Manual.</p>
<p>Contact your engagement lead if you need further information.</p>
</div>
<div class="section" id="connect-your-service-to-the-matching-service-adapter-metadata">
<span id="saml-access-metadata"></span><span id="configureadapttechnology"></span><h2>Connect your service to the Matching Service Adapter metadata<a class="headerlink" href="#connect-your-service-to-the-matching-service-adapter-metadata" title="Permalink to this headline">¶</a></h2>
<p>To integrate GOV.UK Verify into your service, you need to connect your service to the Matching Service Adapter (MSA) metadata.</p>
<p>The MSA metadata:</p>
<ul class="simple">
<li>indicates the URL where your service will send users with their authentication requests - this is the GOV.UK Verify hub</li>
<li>lists one or more MSA signing certificates, so your service can validate messages that are sent by your MSA</li>
<li>describes the MSA as an identity provider</li>
</ul>
<p>The MSA metadata is located in your MSA at /matching-service/SAML2/metadata</p>
<p>Your service must poll the MSA metadata every 10 minutes.</p>
</div>
<div class="section" id="send-a-saml-authentication-request-to-the-gov-uk-verify-hub">
<span id="saml-consume-responses"></span><h2>Send a SAML authentication request to the GOV.UK Verify hub<a class="headerlink" href="#send-a-saml-authentication-request-to-the-gov-uk-verify-hub" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Use your chosen <a class="reference internal" href="#chooseproductframework"><span>product and framework</span></a> to build a SAML authentication request in XML:</li>
</ol>
<blockquote>
<div><div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="l l-Scalar l-Scalar-Plain">&lt;saml2p:AuthnRequest ...&gt;</span>
  <span class="l l-Scalar l-Scalar-Plain">&lt;saml2:Issuer xmlns:saml2=&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot; Format=&quot;urn:oasis:names:tc:SAML:2.0:nameid-format:entity&quot;&gt;http://www.test-rp.gov.uk/SAML2/MD&lt;/saml2:Issuer&gt;</span>
  <span class="l l-Scalar l-Scalar-Plain">&lt;ds:Signature xmlns:ds=&quot;http://www.w3.org/2000/09/xmldsig#&quot;&gt;</span>
    <span class="l l-Scalar l-Scalar-Plain">&lt;ds:SignedInfo&gt;</span>
      <span class="l l-Scalar l-Scalar-Plain">&lt;ds:CanonicalizationMethod Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;/&gt;</span>
      <span class="l l-Scalar l-Scalar-Plain">&lt;ds:SignatureMethod Algorithm=&quot;http://www.w3.org/2001/04/xmldsig-more#rsa-sha256&quot;/&gt;</span>
      <span class="l l-Scalar l-Scalar-Plain">&lt;ds:Reference URI=&quot;#_60f75dc5-f9eb-43cf-adfc-5814016a626c&quot;&gt;</span>
        <span class="l l-Scalar l-Scalar-Plain">&lt;ds:Transforms&gt;</span>
          <span class="l l-Scalar l-Scalar-Plain">&lt;ds:Transform Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#enveloped-signature&quot;/&gt;</span>
          <span class="l l-Scalar l-Scalar-Plain">&lt;ds:Transform Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;/&gt;</span>
        <span class="l l-Scalar l-Scalar-Plain">&lt;/ds:Transforms&gt;</span>
        <span class="l l-Scalar l-Scalar-Plain">&lt;ds:DigestMethod Algorithm=&quot;http://www.w3.org/2001/04/xmlenc#sha256&quot;/&gt;</span>
        <span class="l l-Scalar l-Scalar-Plain">&lt;ds:DigestValue&gt;O+LkTbydEWNPSLThcblzSqd/BvlGAI0dWwGVgd6ixkE=&lt;/ds:DigestValue&gt;</span>
      <span class="l l-Scalar l-Scalar-Plain">&lt;/ds:Reference&gt;</span>
    <span class="l l-Scalar l-Scalar-Plain">&lt;/ds:SignedInfo&gt;</span>
    <span class="l l-Scalar l-Scalar-Plain">&lt;ds:SignatureValue&gt;</span>
<span class="l l-Scalar l-Scalar-Plain">O8x8ILlqoiCKg8LMSqlajyX5JhLDxHSltUXYAalGnFb0L41Up5hQuFrEXBNxfNiUo3ChlZA+FIWw</span>
<span class="l l-Scalar l-Scalar-Plain">WkK5OSSqqJQ9IqgUFUapDVZUewerOGLQ/Qw80linrbc24w21JIWDnpoT8qrdt+c9EgkQTvKrwDmf</span>
<span class="l l-Scalar l-Scalar-Plain">JfXUcbTCvuhnOTVrG/5Fv64sruBu9CVTSnvj/Jvy1bwK2HsvMmxrAO8og+iFvMx1KB7YCG1Puj/Z</span>
<span class="l l-Scalar l-Scalar-Plain">frJRKYU3QgAehUR0hrUj1ReVGV4cx1Yy7FhUKnYpdsYRVxpv1McwkDXHVs5iao+0vv7rLGLw9U1d</span>
<span class="l l-Scalar l-Scalar-Plain">a7lBaFhC2AT1wi+ogaO8nzZ/d3G6p0tHrMSqQA==</span>
    <span class="l l-Scalar l-Scalar-Plain">&lt;/ds:SignatureValue&gt;</span>
  <span class="l l-Scalar l-Scalar-Plain">&lt;/ds:Signature&gt;</span>
<span class="l l-Scalar l-Scalar-Plain">&lt;/saml2p:AuthnRequest&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Send the authentication request to the URL indicated in the element <code class="docutils literal"><span class="pre">SingleSignonService</span></code> in the MSA metadata.</li>
</ol>
</div>
<div class="section" id="handle-saml-responses-using-saml-metadata">
<span id="saml-handle-responses"></span><h2>Handle SAML responses using SAML metadata<a class="headerlink" href="#handle-saml-responses-using-saml-metadata" title="Permalink to this headline">¶</a></h2>
<p>To consume SAML responses that are issued by the GOV.UK Verify hub:</p>
<ol class="arabic">
<li><p class="first">Decrypt the assertion.</p>
</li>
<li><p class="first">Validate the signature on the assertion contained in the response. This assertion is generated and signed by your MSA.</p>
<p>You can use the X509 signing certificate contained in the MSA metadata to validate this signature.</p>
</li>
</ol>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Use this procedure with care. You must trust assertions signed by the MSA only. The GOV.UK Verify hub never issues assertions for consumption by the service endpoint, so make sure that it’s <em>not</em> possible to trust the hub to issue assertions.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="samlComplianceTool.html" class="btn btn-neutral float-right" title="Run SAML compliance tests" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="samlWorks.html" class="btn btn-neutral" title="How SAML works with GOV.UK Verify" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
<div>Is there anything wrong with this page? Contact <a title="Contact Verify support" href="mailto:idasupport+onboarding@digital.cabinet-office.gov.uk">idasupport+onboarding@digital.cabinet-office.gov.uk</a> if you have any feedback.</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>