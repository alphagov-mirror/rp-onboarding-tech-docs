.. _steps:

Steps to integrate with GOV.UK Verify
===================================================

Development
~~~~~~~~~~~~~~

.. csv-table:: 
   :header: "Step", "What you need to do"
   :name: "stepsdev"
   :widths: 1, 10


   "1.", "**Build a service that produces and consumes SAML.** 

   .. _step-build-service: 

   To do this: 

    1. Read the SAML specifications described in the '`Identity Assurance Hub Service SAML 2.0 Profile <https://www.gov.uk/government/publications/identity-assurance-hub-service-saml-20-profile>`_'.
    2. :ref:`Choose a product and framework <samlIntegrationtool>` to integrate your service with GOV.UK Verify.
    3. :ref:`Configure and adapt your chosen technology <ConfigureAdaptTechnology>` to respect the SAML profile.
    4. Decide how to :ref:`store and manage keys <pki_store_private_key>` and certificates so you can :ref:`rotate your keys <pkiRotate>` when needed. 

   Outcome:  your service can send SAML authentication requests to, and receive SAML responses from, the GOV.UK Verify hub.


   For more information, see :ref:`samlWorks`."
   "2.", "**Build a local matching service.** 

   .. _step-build-LMS: 

   To do this:

    1. :ref:`Define your matching strategy <ms_strat>` with your service manager.
    2. Use the :ref:`example JSON matching request <RespondJSONmr>` and the :ref:`JSON schema <JSONschema>` to help build your local matching service.

   Outcome: your service can match usersâ€™ verified identities to your data sources.

   For more information, see :ref:`msWorks`."
   "3.", "**Set up the Matching Service Adapter for the SAML compliance tool.** 
    
   .. _step-setup-MSAforSAML: 

   To do this: 

    1. :ref:`Download and install the Matching Service Adapter <msa_install_msa>`.
    2. :ref:`Generate self-signed certificates for the SAML compliance tool <samlCTselfsigncert>`.
    3. :ref:`Configure the Matching Service Adapter for the SAML compliance tool <ConfigureMSA>`.

   Outcome: you're ready to run SAML compliance tests.

   For more information, see :ref:`msa`."
   "4.", "**Run SAML compliance tests.** 

   .. _step-run-SAML-tests:

   To do this: 

    1. :ref:`Test your service with the SAML compliance tool <samlCTservicehub>`.
    2. :ref:`Test your matching service with the SAML compliance tool <samlCThubMSA>`.

   Outcome: your service and matching service can consume and produce valid SAML.

   For more information, see see :ref:`samlWorks`."

Integration
~~~~~~~~~~~~~~   

.. csv-table:: 
   :header: "Step", "What you need to do"
   :name: "stepsinteg"
   :widths: 1, 10

   "1.", "**Request access to the integration environment.** 

   .. _step-request-int-env:

   To do this:

    1. Send the GOV.UK Verify operations team the IP address where you'll host the Matching Service Adapter. 
      
     This allows GOV.UK Verify to put in place firewall rules so the hub can communicate with the Matching Service Adapter. 

    2. Send the GOV.UK Verify operations team the IP addresses of the browsers you'll use when testing in the integration environment. 

      Access to the hub and the test identity providers in the integration environment is restricted by IP address.

    3. Obtain :ref:`signed certificates <pkiRequestCert>` for the integration environment from the IDAP test certificate authority. 

    4. Send the GOV.UK Verify operations team your signed certificates for the integration environment. 

    5. Fill in the ':ref:`Request access to an environment <envRequestform>`' form.


   Outcome: you're ready to connect the Matching Service Adapter and your service to the integration environment.
 
   For more information, see :ref:`env` and :ref:`pkiWorks`."
   "2.", "**Connect the Matching Service Adapter and your service to the integration environment.** 

   To do this:

   .. _step-connect-MSA-int-env:

    1. :ref:`Download and install the Matching Service Adapter <msa_install_msa>`.
    2. :ref:`Configure the Matching Service Adapter for the integration environment <ConfigureMSA>`.


   Outcome: you're ready to run end-to-end testing with test users.

   For more information, see :ref:`msa` and :ref:`env`."
   "3.", "**Run end-to-end testing of all your user journeys in the integration environment.** 

   .. _step-run-end-to-end-tests:

   To do this:

    1. :ref:`Set up authentication to manage test users <CreateAuth>`.
    2. :ref:`Create test users <CreateTestUsers>`.
    3. :ref:`Run end-to-end tests <RunEtoEtest>`.

   Outcome: your service can handle all the possible outcomes of end-to-end user journeys.

   For more information, :ref:`env`."
   "4.", "**Request access to the production environment.** 

   .. _step-request-prod-env:

   To do this:

    1. Send the GOV.UK Verify operations team the IP address where you'll host the Matching Service Adapter. 

      This allows GOV.UK Verify to put in place firewall rules so the hub can communicate with the Matching Service Adapter. 

    2. Obtain :ref:`signed certificates <pkiRequestCert>` for the production environment from the IDAP certificate authority. 

    3. Send the GOV.UK Verify operations team your signed certificates for the production environment. 

    4. Fill in the ':ref:`Request access to an environment <envRequestform>`' form.
    
   Outcome: you're ready to connect the Matching Service Adapter and your service to the production environment.

   For more information, see :ref:`env` and :ref:`pkiWorks`."
   "5.", "**Connect the Matching Service Adapter and your service to the production environment.** 

   .. _step-connect-MSA-prod-env:

   To do this:
 
    1. :ref:`Download and install the Matching Service Adapter <msa_install_msa>`.
    2. :ref:`Configure the Matching Service Adapter for the production environment <ConfigureMSA>`.
    3. Connect your service to the production environment by :ref:`accessing the federation metadata <saml_access_metadata>`.

   Outcome: your service is ready to go live.

   For more information, see :ref:`msa` and :ref:`env`."

Maintenance
~~~~~~~~~~~~~~

.. csv-table:: 
   :header: "Step", "For more information"
   :name: "stepsmaint"
   :widths: 1, 10

   "1.", "**Rotate your keys**.

       .. _step-rotate-keys:

    When the certificates containing your public keys are due to expire, :ref:`run the key rotation process <pkiRotate>` to replace your keys and certificates.

    Outcome: the encryption and signing certificates for your service and Matching Service Adapter are up to date.

    For more information, see :ref:`pkiWorks`."







   





