.. _samlIntegration:


Build your service
=======================

.. _samlIntegrationtool:


Use extended validation certificates
-------------------------------------

You must use extended validation (EV) certificates for all public interactions with your service. When you use EV certificates, the user's web browser clearly indicates the name of the organisation they are interacting with.


Using EV certificates is one of a range of measures to protect your users from sites pretending to be you. See best practices for `using TLS to protect data <https://www.ncsc.gov.uk/guidance/tls-external-facing-services>`_ from the National Cyber Security Centre (NCSC).



Choose a product and framework
--------------------------------------

Your government service must be able to send SAML authentication requests to, and receive SAML responses from, the GOV.UK Verify hub. 

You can choose from a wide range of off-the-shelf products and frameworks to integrate your service with GOV.UK Verify. 

GOV.UK Verify has experience integrating and supporting services using Shibboleth-SP (Service Provider) and OpenSAML libraries. This has worked well for teams using Java. However, please use the most appropriate products and frameworks for your team.  See `Choosing technology <https://www.gov.uk/service-manual/making-software/choosing-technology.html>`_ in the Government Service Design Manual. 

Contact your engagement lead if you need further information.


.. _ConfigureAdaptTechnology:

.. _saml_access_metadata:


Connect your service to the Matching Service Adapter metadata
----------------------------------------------------------------

To integrate GOV.UK Verify into your service, you need to connect your service to the Matching Service Adapter (MSA) metadata. 


The MSA metadata:

* indicates the URL where your service will send users with their authentication requests - this is the GOV.UK Verify hub 

* lists one or more MSA signing certificates, so your service can validate messages that are sent by your MSA

* describes the MSA as an identity provider




The MSA metadata is located in your MSA at /matching-service/SAML2/metadata

Your service must poll the MSA metadata every 10 minutes. 



.. _saml_consume_responses:

Handle responses using SAML metadata
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To consume SAML responses that are issued by the GOV.UK Verify hub:
 
1. Decrypt the assertion.

2. Validate the signature on the assertion contained in the response. This assertion is generated and signed by your MSA. 

   You can use the X509 signing certificate contained in the MSA metadata to validate this signature.

.. caution:: Use this procedure with care. You must trust assertions signed by the MSA only. The GOV.UK Verify hub never issues assertions for consumption by the service endpoint, so make sure that itâ€™s *not* possible to trust the hub to issue assertions.





